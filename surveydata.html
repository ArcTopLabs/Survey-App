<!DOCTYPE html>
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="css/bootstrap.min.css" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="css/bootstrap-theme.min.css" crossorigin="anonymous">

        <link href="css/starter-template.css" rel="stylesheet">

				<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js"></script>
<script src="surveyjs/survey.ko.min.js"></script>

        <!-- Latest compiled and minified JavaScript -->
        <script src="js/bootstrap.min.js" crossorigin="anonymous"></script>
        <script>

	
		
		
            $(document).ready(function () {
			
			var name = "";
			var surveyres = "";
			var survedata;
			var surveyid;
			var SendInfo = { "filter" : { "name" : "sample1"},  "limit": 4, "sort": {"created_date": "desc"}};
                        var dataString = JSON.stringify(SendInfo);
			
			
			 $.ajax({
                        url: 'http://api.masterdatanode.com/sample/survey/find/',
                        type: 'post',
//                        data: {},
                       data: dataString,
                        headers: {
                            "access_token": '##############access_token#####################'   //####Access_Token########
                            "Content-Type": 'application/json'
                        },
                        dataType: 'json',
                        success: function (data) {

                            console.info(JSON.stringify(data));

                            //$("#test_div").html(JSON.stringify(data));
                            $("#test_div").show();
                            var obj = JSON.parse(JSON.stringify(data));
                            //var mytable =  $('#example').DataTable();
                            var result = $.parseJSON(JSON.stringify(obj.result));
							

                            $.each(result, function (k, jsonObject) {
                                name = jsonObject.name;
                                surveyres = jsonObject.survey;
								surveyid = k;
								survedata = surveyres.replace(/\n/g, '')
                                console.log(surveyres.replace(/\n/g, ''));	
                                // .... add all the values required
                                console.info(survedata);

                            });

                           
                            //mytable.draw();
                            console.info('-------------- ' +survedata);
								console.log("HELLO");
								setTimeout(function(){
								
									var json = JSON.parse(survedata);
									console.log(json);
									//alert(survedata);
									
									Survey.Survey.cssType = "bootstrap";
									var survey = new Survey.Survey( json, "surveyContainer");
									//Use onComplete event to save the data
									//survey.onComplete.add(sendDataToServer);
									survey.onComplete.add(function (s) {
									    var SendInfo= { "Data" : [{ "id": surveyid, "name": name, "surveyresult": s.data}]};
										alert("The results are:" + JSON.stringify(s.data));
										$.ajax({
											url: 'https://api.masterdatanode.com/sample/surveyresult/save',
											type: 'post',
											data: JSON.stringify(SendInfo),
											headers: {
											"access_token": '##############access_token#####################',
													"Content-Type":  	'application/json'
													
											},
											dataType: 'json',
											success: function (data) {
											console.info(JSON.stringify(data));
												 $("#test_div").html( "Your data is been successfully recorded with us" );
											}
										});
										
									 });
									
								}, 2000);
								console.log("DOG");

							


                        }
                    });
			
			
			
			    	

			
			
			
               
            });
        </script>
    </head>
    <body>


        <div class="container " style="text-align: center;">

            <div >
                <h1>Survey</h1>
            </div>
            <div >
                User Survey Editor to get your suvey ready <a href="http://surveyjs.org/builder/" > Click Here </a>
            </div>
			
          

        </div>
		
		
		 <div class="container " style="text-align: left;">
		 
		 <div id="surveyContainer"></div>
		 <div id="test_div" ></div>
		 </div>
		
		


    </body>
</html>
